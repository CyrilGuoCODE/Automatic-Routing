<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Automatic-Routing | 智能域名路由系统</title>
  <meta name="description" content="Automatic-Routing是一个智能域名路由系统，可以根据用户的网络延迟自动将访问者重定向到最佳的域名。">
  <!-- 配置备用域名列表 -->
  <meta name="automatic-routing-domains" content="blog.gwly.dpdns.org,gwly.dpdns.org,gwlyweb.pages.dev">
  <style>
    :root {
      --primary-color: #3498db;
      --primary-dark: #2980b9;
      --secondary-color: #2c3e50;
      --accent-color: #e74c3c;
      --success-color: #2ecc71;
      --warning-color: #f39c12;
      --light-bg: #f8f9fa;
      --card-bg: #ffffff;
      --border-radius: 8px;
      --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: var(--light-bg);
      padding: 0;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      background-color: var(--primary-color);
      color: white;
      padding: 2rem 0;
      text-align: center;
      border-radius: 0 0 var(--border-radius) var(--border-radius);
      box-shadow: var(--box-shadow);
      margin-bottom: 2rem;
      position: relative;
      overflow: hidden;
    }
    
    header h1 {
      margin: 0;
      font-size: 2.2rem;
      position: relative;
      z-index: 2;
    }
    
    header p {
      margin: 10px 0 0;
      opacity: 0.9;
      font-size: 1.1rem;
      position: relative;
      z-index: 2;
    }
    
    .header-bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0.3;
      z-index: 1;
    }
    
    .logo {
      width: 80px;
      height: 80px;
      margin-bottom: 15px;
    }
    
    h2 {
      color: var(--secondary-color);
      margin-bottom: 1rem;
      border-bottom: 2px solid var(--primary-color);
      padding-bottom: 8px;
      font-size: 1.6rem;
    }
    
    .card {
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: var(--box-shadow);
      transition: var(--transition);
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
    }
    
    .card-icon {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .card-icon svg {
      width: 24px;
      height: 24px;
      margin-right: 10px;
      color: var(--primary-color);
    }
    
    code {
      background-color: #f0f0f0;
      padding: 2px 4px;
      border-radius: 4px;
      font-family: 'Courier New', Courier, monospace;
      font-size: 0.9em;
    }
    
    pre {
      background-color: #f0f0f0;
      padding: 15px;
      border-radius: var(--border-radius);
      overflow-x: auto;
      border-left: 4px solid var(--primary-color);
      margin: 15px 0;
    }
    
    .warning {
      background-color: #fff3cd;
      border-left: 4px solid var(--warning-color);
      padding: 15px;
      margin: 20px 0;
      border-radius: var(--border-radius);
    }
    
    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-size: 16px;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
    }
    
    button:hover {
      background-color: var(--primary-dark);
    }
    
    button svg {
      width: 16px;
      height: 16px;
      margin-right: 8px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
      background-color: white;
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    
    th {
      background-color: #f8f9fa;
      color: var(--secondary-color);
      font-weight: 600;
    }
    
    tr:last-child td {
      border-bottom: none;
    }
    
    tr:hover {
      background-color: #f8f9fa;
    }
    
    .status-success {
      color: var(--success-color);
    }
    
    .status-fail {
      color: var(--accent-color);
    }
    
    footer {
      text-align: center;
      padding: 20px;
      margin-top: 30px;
      color: #7f8c8d;
      font-size: 0.9rem;
      border-top: 1px solid #eee;
    }
    
    /* 高级功能面板样式 */
    .tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid #ddd;
    }

    .tab {
      padding: 10px 20px;
      cursor: pointer;
      margin-right: 5px;
      transition: all 0.3s;
    }

    .tab:hover {
      background-color: #f0f0f0;
    }

    .tab.active {
      border-bottom: 2px solid var(--primary-color);
      font-weight: bold;
      color: var(--primary-color);
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.5s;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .tab-content.active {
      display: block;
    }

    .settings-row {
      margin: 15px 0;
      display: flex;
      align-items: center;
    }

    .settings-label {
      width: 200px;
      font-weight: 500;
    }

    select, input {
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ddd;
      transition: border-color 0.3s;
    }

    select:focus, input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 3px rgba(52, 152, 219, 0.3);
    }

    .chart-container {
      height: 200px;
      margin: 20px 0;
      background-color: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .bar {
      height: 30px;
      margin: 10px 0;
      background-color: var(--primary-color);
      border-radius: 3px;
      position: relative;
      transition: width 1s;
      display: flex;
      align-items: center;
      color: white;
      padding-left: 10px;
    }

    .bar-label {
      position: absolute;
      left: 10px;
      color: white;
      z-index: 1;
    }

    .bar-value {
      position: absolute;
      right: 10px;
      color: white;
      z-index: 1;
    }

    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border-left-color: var(--primary-color);
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .domain-result {
      background-color: white;
      border-radius: 4px;
      padding: 15px;
      margin: 15px 0;
      border-left: 4px solid #ddd;
      transition: transform 0.2s;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .domain-result:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .domain-result.best {
      border-left-color: var(--success-color);
    }

    .domain-name {
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .best-badge {
      background-color: var(--success-color);
      color: white;
      font-size: 12px;
      padding: 3px 8px;
      border-radius: 12px;
    }

    .domain-metrics {
      display: flex;
      justify-content: space-between;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    .domain-metric {
      flex: 1;
      min-width: 130px;
      margin: 4px;
      padding: 10px;
      background-color: #f9f9f9;
      border-radius: 3px;
      text-align: center;
      transition: background-color 0.2s;
    }

    .domain-metric:hover {
      background-color: #f0f0f0;
    }

    .metric-label {
      font-size: 12px;
      color: #7f8c8d;
      margin-bottom: 5px;
    }

    .btn-secondary {
      background-color: #95a5a6;
    }

    .btn-secondary:hover {
      background-color: #7f8c8d;
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      header {
        padding: 1.5rem 0;
      }
      
      header h1 {
        font-size: 1.8rem;
      }
      
      .card {
        padding: 20px;
      }
      
      .settings-row {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .settings-label {
        margin-bottom: 5px;
      }
      
      .domain-metrics {
        flex-direction: column;
      }
      
      .domain-metric {
        margin: 5px 0;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-bg">
      <!-- 背景图案 SVG -->
      <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
        <pattern id="pattern" width="40" height="40" patternUnits="userSpaceOnUse">
          <path d="M0 20 L40 20 M20 0 L20 40" stroke="white" stroke-width="1" fill="none"/>
        </pattern>
        <rect width="100%" height="100%" fill="url(#pattern)" />
      </svg>
    </div>
    <div class="container">
      <!-- Logo SVG -->
      <svg class="logo" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="12" r="10" stroke="white" stroke-width="2" fill="none"/>
        <path d="M12 2 L12 22 M2 12 L22 12" stroke="white" stroke-width="2"/>
        <path d="M17 7 L7 17 M7 7 L17 17" stroke="white" stroke-width="2"/>
        <circle cx="12" cy="12" r="4" fill="white"/>
      </svg>
      <h1>Automatic-Routing</h1>
      <p>智能域名路由系统 · 提升网站访问体验</p>
    </div>
  </header>

  <div class="container">
    <div class="card">
      <div class="card-icon">
        <!-- 状态图标 SVG -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 10h-4V4h-4v6H6l6 6 6-6z"></path>
          <path d="M3 17v4h18v-4"></path>
        </svg>
        <h2>当前状态</h2>
      </div>
      <p>当前域名: <strong id="current-domain"></strong></p>
      <p>最佳域名: <strong id="best-domain">正在检测...</strong></p>
      
      <!-- 新增：域名列表和取消重定向按钮 -->
      <div id="domains-list" style="margin-top: 15px;">
        <p>即将分析的域名列表:</p>
        <ul id="domains-to-analyze" style="list-style-type: none; padding: 0; margin: 10px 0;">
          <!-- 域名列表将通过JS动态填充 -->
        </ul>
      </div>
      
      <div style="margin-top: 15px; display: flex; gap: 10px;">
        <button id="cancel-redirect" onclick="cancelRedirection()" style="background-color: var(--accent-color);">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
          </svg>
          暂停自动重定向
        </button>
        <button id="enable-redirect" onclick="enableRedirection()" style="display: none;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
          启用自动重定向
        </button>
      </div>
    </div>

    <div id="file-warning" class="warning" style="display: none;">
      <div class="card-icon">
        <!-- 警告图标 SVG -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <h3>本地文件警告</h3>
      </div>
      <p>检测到您正在使用<code>file://</code>协议访问此页面。由于浏览器的安全限制，自动路由功能在本地文件中无法正常工作。</p>
      <p>请将这些文件部署到Web服务器上，或使用以下简易方法在本地测试：</p>
      <ol>
        <li>在当前目录打开命令行终端</li>
        <li>
          如果已安装Python，运行:
          <pre>python -m http.server 8000</pre>
          或者 
          <pre>python3 -m http.server 8000</pre>
        </li>
        <li>
          如果已安装Node.js，运行:
          <pre>npx http-server -p 8000</pre>
        </li>
        <li>然后访问 <a href="http://localhost:8000">http://localhost:8000</a></li>
      </ol>
    </div>

    <div class="card">
      <div class="card-icon">
        <!-- 指南图标 SVG -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
          <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
        </svg>
        <h2>使用方法</h2>
      </div>
      <p>将以下两个文件添加到您的网站中：</p>
      <ol>
        <li><code>redirect.js</code> - 自动路由的核心脚本</li>
        <li>在HTML的<code>&lt;head&gt;</code>部分添加域名配置和脚本引用：</li>
      </ol>
      <pre>&lt;meta name="automatic-routing-domains" content="example.com,cdn.example.com"&gt;
&lt;script src="redirect.js"&gt;&lt;/script&gt;</pre>
    </div>

    <div class="card">
      <div class="card-icon">
        <!-- 测试图标 SVG -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path>
          <line x1="16" y1="8" x2="2" y2="22"></line>
          <line x1="17.5" y1="15" x2="9" y2="15"></line>
        </svg>
        <h2>手动测试</h2>
      </div>
      <p>您可以使用控制台手动初始化或配置自动路由：</p>
      <pre>// 配置并初始化
AutomaticRouting.init({
  domains: ['example.com', 'cdn.example.com'],
  priorityFactor: 'latency', // 'latency', 'ttfb', 或 'combined'
  forceRedirect: true // 强制重定向，即使已有Cookie
});</pre>
      <button onclick="testDomains()">
        <!-- 运行图标 SVG -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="5 3 19 12 5 21 5 3"></polygon>
        </svg>
        测试域名性能
      </button>
      <div id="test-results" style="margin-top: 15px;"></div>
    </div>

    <!-- 高级功能面板 -->
    <div class="card">
      <div class="card-icon">
        <!-- 高级功能图标 SVG -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
        <h2>高级功能</h2>
      </div>

      <button id="toggle-advanced" class="btn" style="margin-bottom: 20px;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
        <span>显示高级功能</span>
      </button>

      <div id="advanced-panel" style="display: none;">
        <div class="tabs">
          <div class="tab active" data-tab="test-results">测试结果</div>
          <div class="tab" data-tab="settings">配置设置</div>
          <div class="tab" data-tab="manual-test">手动测试</div>
        </div>
        
        <!-- 测试结果标签页 -->
        <div class="tab-content active" id="test-results-tab">
          <h3>当前性能状况</h3>
          
          <!-- 性能指标图表 -->
          <div class="chart-container" id="performance-chart">
            <p>暂无数据，请点击"开始测试"按钮生成性能图表。</p>
          </div>
          
          <div class="domain-results" id="domain-results">
            <!-- 结果将通过JavaScript动态生成 -->
            <p>暂无测试结果，请点击"开始测试"按钮。</p>
          </div>
          <button class="btn" id="start-test">开始测试</button>
          <button class="btn btn-secondary" id="stop-redirection">阻止自动重定向</button>
        </div>
        
        <!-- 配置设置标签页 -->
        <div class="tab-content" id="settings">
          <h3>测试配置</h3>
          
          <div class="settings-row">
            <div class="settings-label">优先因素：</div>
            <select id="priority-factor">
              <option value="combined">综合评分</option>
              <option value="latency">网络延迟</option>
              <option value="ttfb">首字节时间</option>
              <option value="responseTime">响应时间</option>
            </select>
          </div>
          
          <div class="settings-row">
            <div class="settings-label">测试方法：</div>
            <select id="test-method">
              <option value="xhr">XHR请求</option>
              <option value="fetch">Fetch API</option>
              <option value="image">图片加载</option>
              <option value="page">页面加载</option>
            </select>
          </div>
          
          <div class="settings-row">
            <div class="settings-label">样本数量：</div>
            <input type="number" id="sample-size" min="1" max="5" value="1">
          </div>
          
          <div class="settings-row">
            <div class="settings-label">超时时间(毫秒)：</div>
            <input type="number" id="timeout" min="1000" max="10000" step="1000" value="5000">
          </div>
          
          <h3>指标权重</h3>
          
          <div class="settings-row">
            <div class="settings-label">网络延迟：</div>
            <input type="range" id="latency-weight" min="0" max="1" step="0.1" value="0.4">
            <span id="latency-weight-value">0.4</span>
          </div>
          
          <div class="settings-row">
            <div class="settings-label">首字节时间：</div>
            <input type="range" id="ttfb-weight" min="0" max="1" step="0.1" value="0.3">
            <span id="ttfb-weight-value">0.3</span>
          </div>
          
          <div class="settings-row">
            <div class="settings-label">响应时间：</div>
            <input type="range" id="response-time-weight" min="0" max="1" step="0.1" value="0.2">
            <span id="response-time-weight-value">0.2</span>
          </div>
          
          <div class="settings-row">
            <div class="settings-label">连接稳定性：</div>
            <input type="range" id="stability-weight" min="0" max="1" step="0.1" value="0.1">
            <span id="stability-weight-value">0.1</span>
          </div>
          
          <button class="btn" id="apply-settings">应用设置</button>
        </div>
        
        <!-- 手动测试标签页 -->
        <div class="tab-content" id="manual-test">
          <h3>手动域名测试</h3>
          <p>输入域名并测试其性能：</p>
          
          <div class="settings-row">
            <div class="settings-label">域名：</div>
            <input type="text" id="manual-domain" placeholder="example.com">
            <button class="btn" id="test-domain" style="margin-left: 10px;">测试域名</button>
          </div>
          
          <div id="manual-test-result" style="display: none; margin-top: 15px;">
            <h4>测试结果</h4>
            <div class="domain-result">
              <div class="domain-name" id="result-domain">example.com</div>
              <div class="domain-metrics">
                <div class="domain-metric">
                  <div class="metric-label">网络延迟</div>
                  <div class="metric-value" id="result-latency">--</div>
                </div>
                <div class="domain-metric">
                  <div class="metric-label">首字节时间</div>
                  <div class="metric-value" id="result-ttfb">--</div>
                </div>
                <div class="domain-metric">
                  <div class="metric-label">响应时间</div>
                  <div class="metric-value" id="result-response-time">--</div>
                </div>
                <div class="domain-metric">
                  <div class="metric-label">状态</div>
                  <div class="metric-value" id="result-status">--</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="container">
    <p>Automatic-Routing 智能域名路由系统v1.5 &copy; 2025 由 <a href="https://github.com/cyrilguocode" target="_blank" style="color: var(--primary-color); text-decoration: none;">CyrilGuo</a> 开发</p>
    <p>
      <a href="https://github.com/cyrilguocode/automatic-routing" target="_blank" style="color: var(--primary-color); text-decoration: none;">
        <!-- GitHub图标 SVG -->
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 5px;">
          <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
        </svg>
        GitHub 项目
      </a>
    </p>
  </footer>

  <!-- 引入自动路由脚本 -->
  <script src="redirect.js"></script>
  
  <script>
    // 显示当前域名
    document.getElementById('current-domain').textContent = window.location.hostname || '本地文件';
    
    // 添加取消重定向功能
    function cancelRedirection() {
      if (window.AutomaticRouting && window.AutomaticRouting.config) {
        window.AutomaticRouting.config.forceRedirect = false;
        // 删除Cookie
        document.cookie = 'ar_best_domain=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/;';
        document.getElementById('cancel-redirect').style.display = 'none';
        document.getElementById('enable-redirect').style.display = 'inline-flex';
        
        // 显示状态提示
        const statusAlert = document.createElement('div');
        statusAlert.className = 'warning';
        statusAlert.style.marginTop = '10px';
        statusAlert.innerHTML = `<p>已禁用自动重定向，当前页面将不会跳转。</p>`;
        document.getElementById('domains-list').appendChild(statusAlert);
        
        setTimeout(() => {
          statusAlert.style.opacity = '0';
          statusAlert.style.transition = 'opacity 0.5s';
          setTimeout(() => statusAlert.remove(), 500);
        }, 3000);
      }
    }
    
    function enableRedirection() {
      if (window.AutomaticRouting && window.AutomaticRouting.config) {
        window.AutomaticRouting.config.forceRedirect = true;
        document.getElementById('cancel-redirect').style.display = 'inline-flex';
        document.getElementById('enable-redirect').style.display = 'none';
        
        // 显示状态提示
        const statusAlert = document.createElement('div');
        statusAlert.className = 'warning';
        statusAlert.style.marginTop = '10px';
        statusAlert.style.backgroundColor = '#d4edda';
        statusAlert.style.borderLeftColor = 'var(--success-color)';
        statusAlert.innerHTML = `<p>已启用自动重定向，系统将自动选择最佳域名。</p>`;
        document.getElementById('domains-list').appendChild(statusAlert);
        
        // 重新测试并找到最佳域名
        window.AutomaticRouting.findBestDomain();
        
        setTimeout(() => {
          statusAlert.style.opacity = '0';
          statusAlert.style.transition = 'opacity 0.5s';
          setTimeout(() => statusAlert.remove(), 500);
        }, 3000);
      }
    }
    
    // 检查是否为file://协议
    if (window.location.protocol === 'file:') {
      document.getElementById('file-warning').style.display = 'block';
      document.getElementById('best-domain').textContent = '无法在本地文件中测试';
      document.getElementById('cancel-redirect').disabled = true;
      document.getElementById('cancel-redirect').title = '在本地文件模式下不可用';
    } else {
      // 读取Cookie中的最佳域名
      function getCookie(name) {
        const nameEQ = name + '=';
        const ca = document.cookie.split(';');
        for (let i = 0; i < ca.length; i++) {
          let c = ca[i];
          while (c.charAt(0) === ' ') c = c.substring(1, c.length);
          if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
      }
      
      const bestDomain = getCookie('ar_best_domain');
      if (bestDomain) {
        document.getElementById('best-domain').textContent = bestDomain;
      }
    }
    
    // 展示域名列表
    function displayDomainsList() {
      const metaTag = document.querySelector('meta[name="automatic-routing-domains"]');
      if (!metaTag) return;
      
      const domains = metaTag.getAttribute('content').split(',').map(d => d.trim());
      const domainsListEl = document.getElementById('domains-to-analyze');
      
      domains.forEach((domain, index) => {
        const li = document.createElement('li');
        li.style.padding = '6px 0';
        li.style.display = 'flex';
        li.style.alignItems = 'center';
        
        const domainIcon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        domainIcon.setAttribute('width', '16');
        domainIcon.setAttribute('height', '16');
        domainIcon.setAttribute('viewBox', '0 0 24 24');
        domainIcon.setAttribute('fill', 'none');
        domainIcon.setAttribute('stroke', 'var(--primary-color)');
        domainIcon.setAttribute('stroke-width', '2');
        domainIcon.setAttribute('stroke-linecap', 'round');
        domainIcon.setAttribute('stroke-linejoin', 'round');
        domainIcon.style.marginRight = '8px';
        domainIcon.innerHTML = '<path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m9 9a9 9 0 0 1-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9"></path>';
        
        li.appendChild(domainIcon);
        li.appendChild(document.createTextNode(domain));
        domainsListEl.appendChild(li);
      });
    }
    
    // 页面加载时显示域名列表
    window.addEventListener('DOMContentLoaded', displayDomainsList);
    
    // 手动测试域名
    function testDomains() {
      const testResultsDiv = document.getElementById('test-results');
      testResultsDiv.innerHTML = `
        <div style="text-align:center; padding: 20px;">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="spinner" style="animation: spin 1s linear infinite;">
            <circle cx="12" cy="12" r="10" stroke-dasharray="30 60" stroke-linecap="round"></circle>
          </svg>
          <p>测试中，请稍候...</p>
        </div>
        <style>
          @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
        </style>
      `;
      
      // 获取meta标签中的域名列表
      const metaTag = document.querySelector('meta[name="automatic-routing-domains"]');
      if (!metaTag) {
        testResultsDiv.innerHTML = '<p>错误：未找到域名配置</p>';
        return;
      }
      
      const domains = metaTag.getAttribute('content').split(',').map(d => d.trim());
      
      // 显示测试的域名
      testResultsDiv.innerHTML = `<p>测试域名: ${domains.join(', ')}</p>`;
      
      // 测试每个域名（如果不是本地文件）
      if (window.location.protocol !== 'file:') {
        Promise.all(domains.map(domain => {
          return AutomaticRouting.testDomain(domain);
        })).then(domainResults => {
          // 显示结果
          let html = '<h3>测试结果</h3>';
          html += '<table>';
          html += '<tr><th>域名</th><th style="text-align:right">延迟 (ms)</th><th style="text-align:right">TTFB (ms)</th><th style="text-align:center">状态</th></tr>';
          
          // 排序结果
          const sortedResults = [...domainResults].sort((a, b) => a.latency - b.latency);
          
          sortedResults.forEach((result, index) => {
            const isBest = index === 0;
            html += `<tr class="${isBest ? 'best-domain' : ''}">
              <td>${result.domain} ${isBest ? '<span style="color:#2ecc71; font-size:0.8em; margin-left:5px;">最佳</span>' : ''}</td>
              <td style="text-align:right">${result.latency}</td>
              <td style="text-align:right">${result.ttfb}</td>
              <td style="text-align:center" class="${result.success ? 'status-success' : 'status-fail'}">
                ${result.success ? 
                  '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>' : 
                  '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>'
                }
              </td>
            </tr>`;
          });
          
          html += '</table>';
          html += `<p style="margin-top:15px;">最佳域名: <strong style="color:#2ecc71">${sortedResults[0]?.domain || '未知'}</strong></p>`;
          
          testResultsDiv.innerHTML = html;
        }).catch(error => {
          testResultsDiv.innerHTML = `
            <div class="warning">
              <div class="card-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="12" y1="8" x2="12" y2="12"></line>
                  <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
                <p>测试时发生错误: ${error.message}</p>
              </div>
            </div>
          `;
        });
      } else {
        testResultsDiv.innerHTML = `
          <div class="warning">
            <div class="card-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
              </svg>
              <p>无法在本地文件中测试域名性能。请部署到Web服务器后测试。</p>
            </div>
          </div>
        `;
      }
    }

    //================ 高级功能面板相关脚本 ================
    
    // 显示/隐藏高级功能面板
    document.getElementById('toggle-advanced').addEventListener('click', function() {
      var panel = document.getElementById('advanced-panel');
      var toggleButton = document.getElementById('toggle-advanced');
      var toggleText = toggleButton.querySelector('span');
      var toggleIcon = toggleButton.querySelector('svg');
      
      if (panel.style.display === 'block') {
        panel.style.display = 'none';
        toggleText.textContent = '显示高级功能';
        toggleIcon.innerHTML = '<polyline points="6 9 12 15 18 9"></polyline>';
      } else {
        panel.style.display = 'block';
        toggleText.textContent = '隐藏高级功能';
        toggleIcon.innerHTML = '<polyline points="18 15 12 9 6 15"></polyline>';
      }
    });
    
    // 标签页切换
    document.querySelectorAll('.tab').forEach(function(tab) {
      tab.addEventListener('click', function() {
        // 移除所有标签页的active类
        document.querySelectorAll('.tab').forEach(function(t) {
          t.classList.remove('active');
        });
        
        // 隐藏所有内容
        document.querySelectorAll('.tab-content').forEach(function(content) {
          content.classList.remove('active');
        });
        
        // 激活当前标签页
        this.classList.add('active');
        const tabId = this.getAttribute('data-tab');
        const contentElement = document.getElementById(tabId);
        if (contentElement) {
          contentElement.classList.add('active');
        } else if (tabId === 'test-results') {
          // 特殊处理test-results标签，因为有了id差异
          document.getElementById('test-results-tab').classList.add('active');
        }
      });
    });
    
    // 权重滑块值显示
    document.getElementById('latency-weight').addEventListener('input', function() {
      document.getElementById('latency-weight-value').textContent = this.value;
    });
    
    document.getElementById('ttfb-weight').addEventListener('input', function() {
      document.getElementById('ttfb-weight-value').textContent = this.value;
    });
    
    document.getElementById('response-time-weight').addEventListener('input', function() {
      document.getElementById('response-time-weight-value').textContent = this.value;
    });
    
    document.getElementById('stability-weight').addEventListener('input', function() {
      document.getElementById('stability-weight-value').textContent = this.value;
    });
    
    // 应用设置
    document.getElementById('apply-settings').addEventListener('click', function() {
      if (!window.AutomaticRouting || !window.AutomaticRouting.config) {
        alert('无法访问AutomaticRouting配置，请刷新页面后重试。');
        return;
      }
      
      const priorityFactor = document.getElementById('priority-factor').value;
      const testMethod = document.getElementById('test-method').value;
      const sampleSize = parseInt(document.getElementById('sample-size').value);
      const timeout = parseInt(document.getElementById('timeout').value);
      
      const latencyWeight = parseFloat(document.getElementById('latency-weight').value);
      const ttfbWeight = parseFloat(document.getElementById('ttfb-weight').value);
      const responseTimeWeight = parseFloat(document.getElementById('response-time-weight').value);
      const stabilityWeight = parseFloat(document.getElementById('stability-weight').value);
      
      // 更新配置
      window.AutomaticRouting.config.priorityFactor = priorityFactor;
      window.AutomaticRouting.config.testMethod = testMethod;
      window.AutomaticRouting.config.sampleSize = sampleSize;
      window.AutomaticRouting.config.timeout = timeout;
      
      window.AutomaticRouting.config.metrics = {
        latency: latencyWeight,
        ttfb: ttfbWeight,
        responseTime: responseTimeWeight,
        stability: stabilityWeight
      };
      
      // 显示成功提示
      const successAlert = document.createElement('div');
      successAlert.className = 'warning';
      successAlert.style.marginTop = '10px';
      successAlert.style.backgroundColor = '#d4edda';
      successAlert.style.borderLeftColor = 'var(--success-color)';
      successAlert.innerHTML = `<p>设置已应用！</p>`;
      document.getElementById('settings').appendChild(successAlert);
      
      setTimeout(() => {
        successAlert.style.opacity = '0';
        successAlert.style.transition = 'opacity 0.5s';
        setTimeout(() => successAlert.remove(), 500);
      }, 3000);
    });
    
    // 创建性能图表
    function createPerformanceChart(results) {
      const chartContainer = document.getElementById('performance-chart');
      
      // 清空现有内容
      chartContainer.innerHTML = '';
      
      // 找出最大值用于计算比例
      const maxLatency = Math.max(...results.map(r => r.latency === 9999 ? 0 : r.latency));
      const maxWidth = 100; // 最大宽度百分比
      
      // 为每个域名创建一个条形图
      results.forEach(result => {
        // 如果延迟为9999（超时），则显示最小的条
        const latencyPercent = result.latency === 9999 ? 5 : (result.latency / maxLatency * maxWidth);
        
        const barContainer = document.createElement('div');
        barContainer.className = 'bar-container';
        
        const bar = document.createElement('div');
        bar.className = 'bar';
        bar.style.width = '0%'; // 初始宽度为0
        bar.innerHTML = `
          <span class="bar-label">${result.domain}</span>
          <span class="bar-value">${result.latency === 9999 ? '超时' : result.latency + 'ms'}</span>
        `;
        
        barContainer.appendChild(bar);
        chartContainer.appendChild(barContainer);
        
        // 动画展示条形
        setTimeout(() => {
          bar.style.width = `${latencyPercent}%`;
        }, 100);
      });
    }
    
    // 启动批量域名测试
    document.getElementById('start-test').addEventListener('click', function() {
      if (!window.AutomaticRouting) {
        alert('脚本未正确加载，请刷新页面后重试。');
        return;
      }
      
      const metaTag = document.querySelector('meta[name="automatic-routing-domains"]');
      if (!metaTag) {
        alert('未找到域名配置，请检查HTML头部是否包含meta标签。');
        return;
      }
      
      const domains = metaTag.getAttribute('content').split(',').map(d => d.trim());
      const resultsContainer = document.getElementById('domain-results');
      const chartContainer = document.getElementById('performance-chart');
      
      // 清空之前的结果
      resultsContainer.innerHTML = '<div class="spinner"></div><p>正在测试域名，请稍候...</p>';
      chartContainer.innerHTML = '<div class="spinner"></div><p>正在收集性能数据...</p>';
      
      // 收集各域名性能数据
      Promise.all(domains.map(domain => {
        return window.AutomaticRouting.testDomain(domain);
      })).then(results => {
        // 处理结果
        resultsContainer.innerHTML = '';
        
        // 根据延迟排序结果
        const sortedResults = [...results].sort((a, b) => a.latency - b.latency);
        const bestDomain = sortedResults[0]?.domain;
        
        // 创建性能图表
        createPerformanceChart(sortedResults);
        
        // 显示结果
        sortedResults.forEach(result => {
          const isBest = result.domain === bestDomain;
          const resultHtml = `
            <div class="domain-result ${isBest ? 'best' : ''}">
              <div class="domain-name">
                <span>${result.domain}</span>
                ${isBest ? '<span class="best-badge">最佳</span>' : ''}
              </div>
              <div class="domain-metrics">
                <div class="domain-metric">
                  <div class="metric-label">网络延迟</div>
                  <div class="metric-value">${result.latency === 9999 ? '超时' : result.latency + 'ms'}</div>
                </div>
                <div class="domain-metric">
                  <div class="metric-label">首字节时间</div>
                  <div class="metric-value">${(result.ttfb === 0 || result.ttfb === 9999) ? '--' : result.ttfb + 'ms'}</div>
                </div>
                <div class="domain-metric">
                  <div class="metric-label">响应时间</div>
                  <div class="metric-value">${result.responseTime === 9999 ? '超时' : result.responseTime + 'ms'}</div>
                </div>
                <div class="domain-metric">
                  <div class="metric-label">状态</div>
                  <div class="metric-value">${result.success ? '成功' : '失败'}</div>
                </div>
              </div>
            </div>
          `;
          resultsContainer.innerHTML += resultHtml;
        });
      }).catch(error => {
        resultsContainer.innerHTML = `<p>测试失败: ${error.message}</p>`;
        chartContainer.innerHTML = `<p>无法生成图表: ${error.message}</p>`;
      });
    });
    
    // 阻止自动重定向
    document.getElementById('stop-redirection').addEventListener('click', function() {
      if (window.AutomaticRouting && window.AutomaticRouting.config) {
        window.AutomaticRouting.config.forceRedirect = false;
        document.cookie = 'ar_best_domain=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
        alert('已阻止自动重定向，当前页面将不会跳转。');
      }
    });
    
    // 手动测试单个域名
    document.getElementById('test-domain').addEventListener('click', function() {
      const domain = document.getElementById('manual-domain').value.trim();
      
      if (!domain) {
        alert('请输入有效的域名');
        return;
      }
      
      if (!window.AutomaticRouting || !window.AutomaticRouting.testDomain) {
        alert('无法访问测试函数，请刷新页面后重试。');
        return;
      }
      
      // 显示加载状态
      document.getElementById('result-domain').textContent = domain;
      document.getElementById('result-latency').textContent = '测试中...';
      document.getElementById('result-ttfb').textContent = '测试中...';
      document.getElementById('result-response-time').textContent = '测试中...';
      document.getElementById('result-status').textContent = '测试中...';
      document.getElementById('manual-test-result').style.display = 'block';
      
      // 开始测试
      window.AutomaticRouting.testDomain(domain).then(result => {
        document.getElementById('result-latency').textContent = result.latency === 9999 ? '超时' : result.latency + 'ms';
        document.getElementById('result-ttfb').textContent = (result.ttfb === 0 || result.ttfb === 9999) ? '--' : result.ttfb + 'ms';
        document.getElementById('result-response-time').textContent = result.responseTime === 9999 ? '超时' : result.responseTime + 'ms';
        document.getElementById('result-status').textContent = result.success ? '成功' : '失败';
      }).catch(error => {
        alert('测试失败: ' + error.message);
      });
    });
    
    // 检测file://协议
    if (window.location.protocol === 'file:') {
      document.getElementById('file-warning').style.display = 'block';
    }
  </script>
</body>
</html> 